---
title: 세션 기반 인증 방식과 토큰 인증 방식
date: 2020-03-16 23:42:43
tags: ["Certification"]
publish: true
---

## 세션기반 인증 방식

### 세션

- 일정시간 동안 같은 사용자로부터 들어오는 일련의 요구를 하나의 상태로 보고 그 상태를 일정하기 유지시키는 기술.
  - 일정시간이란 방문자가 클라이언트를 통해 서버에 접속한 시점으로부터 방문자가 클라이언트를 종료함으로써 연결을 끝내는 시점.

### 세션 기반 인증 방식 FLOW

1. 사용자가 로그인을 한다.

   - 사용자가 입력한 로그인 정보를 서버로 전달(Request).

2. 서버는 사용자의 Request를 받아 사용자 검증을 한다. 유효할 경우 사용자의 고유한 ID값을 부여하여 세션 저장소에 저장한 후, 이와 연결되는 세션 ID를 생성하여 response header에 포함시켜 반환한다.

   - 대부분의 경우 세션 정보를 서버 메모리 OR DB에 저장한다.

3. 사용자는 서버에서 해당 세션 ID를 받아 쿠키에 저장한 후, 인증이 필요한 요청에 접근할 때 마다 쿠키를 request header에 포함시켜 보낸다.
4. 서버는 쿠키를 받아 세션 저장소에서 검증한 후, 요청에 해당하는 데이터를 반환한다.

## 토큰기반 인증 방식

- 인증 받은 사용자들에게 토큰을 발급하고 서버에 요청을 할 때 header에 토큰을 함께 보내도록 하여 유효성 검사를 하는 방식.

### 토큰 기반 인증 방식 FLOW

1. 사용자가 로그인을 한다.
   - 사용자가 입력한 로그인 정보를 서버로 전달(Request).
2. 서버는 사용자의 Request를 받아 사용자 검증을 한다. 유효할 경우 서버측에서 유저에게 정상적으로 발급된 토큰임을 증명하는 signature를 갖는 토큰을 발급해준다.
3. 클라이언트 측에서 전달받은 토큰을 저장해두고 서버에 요청할 때 마다 해당 토큰을 서버에 같이 전달한다.
4. 서버는 토큰을 검증하고 요청에 응답한다.

### 특징

- 무상태(stateless)이며 확장성이 있다.
  - 토큰을 클라이언트에 저장하기 때문에 완전히 stateless 하다.
  - 클라이언트와 서버의 연결고리가 없기 떄문에 서버의 확장성이 높아진다.
- 플랫폼간 권한 공유
  - 페이스북, 구글 같은 소설 계정들을 이용하여 다른 서비스에서도 권한을 공유할 수 있다(OAuth).
    - OAuth: 인터넷 사용자들이 비밀번호를 제공하지 않고 다른 웹사이트 상의 자신들의 정보에 대해 웹사이트나 애플리케이션의 접근권한을 부여할 수 있는 공통적인 수단으로서 사용되는 접금 위임을 위한 개방형 표준.
- 여러 플랫폼 및 도메인
  - 토큰을 사용하면 어떤 디바이스나 도메인에도 토큰만 유효하다면 요청이 정상적으로 처리된다.
    - 서버측에서 어플리케이션 응답 부분에 `Access-Control-Allow-Origin: *`를 header에 포함시켜주면 된다.
- 웹 표준 기반
  - 토큰 기반 인증 시스템의 구현체인 [JWT](https://jwt.io/)는 개방형 표준 [RFC 7519](https://tools.ietf.org/html/rfc7519)에 등록되어 있다.
- CSRF(Cross-site Request Forgery, 사이트간 요청위조) 방지.
  - 세션 기반 방식은 쿠키가 사용자 정보를 가지고 있기 때문에 사용자가 로그인한 상태에서 사이트간 요청 위조 공격 코드가 삽입된 페이지를 열어도 서버는 요청을 신뢰하고 작업을 수행하게 된다. 그러나 토큰 기반 인증에서는 header 내에 토큰이 포함되어 있으므로 CSRF를 방지할 수 있다.
    - 토큰을 사용하는 환경에서도 취약점이 존재 할 수 있으니 언제나 취약점에 대비해야 한다.

## Reference

> - [Session 이란?](https://88240.tistory.com/190)
> - [서버 기반 인증, 토큰 기반 인증 (Session, Cookie / JSON Web Token)](https://dooopark.tistory.com/6)
> - [[JWT] 토큰(Token) 기반 인증에 대한 소개](https://velopert.com/2350)
